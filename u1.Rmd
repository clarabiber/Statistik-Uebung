---
title: "Übung 1 - Laden, Plotten, Filtern von Daten"
author: "Clara Gravert"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) # sorgt dafür, dass der R-code standardmäßig mit in der HTML Datei erscheint
```

Ziel der Übung ist es, dass Sie R und Rstudio installiert haben (falls Sie nicht dauerhaft an den Rechnern im PC-Pool arbeiten möchten), R-Studio öffnen können und einige grundlegende Funktionen einsetzen können und ein HTML Dokument aus dem RMarkdown Dokument erzeugen können.

In weiteren Übungen gehe ich davon aus, dass Sie diese Schritte beherrschen.

# Vorbereitungen

## Ordnerstruktur

Erzeugen Sie einen Ordner, in dem Sie von nun an die Übungsblätter der Vorlesung Einführung in die Statistik bearbeiten. Wie der Ordner heißt oder wie er benannt ist, ist unerheblich, wichtig ist nur, dass Sie den Ordner wiederfinden. Ich nennen ihn hier einfach *statistik_vorlesung*

Erzeugen Sie innerhalb des Ordners einen weiteren Ordner *data* an. In diesem sollten Sie die benötigten Datensätze aus Moodle speichern.

Natürlich können Sie Ihre Daten auch anders organisieren. Alles Anweisunungen/Erläuterungen gehen jeweils von der angegebenen Struktur aus. Sie müssen dann ggf. die Pfade anpassen.

## Installation

Falls noch nicht passiert, installieren Sie R: https://cran.r-project.org/

Nachdem R installiert ist, installieren Sie die kostenlose Version von R-Studio Desktop: https://www.rstudio.com/products/rstudio/download/

Die Installation ist üblicherweise unproblematisch, wenn Sie den Anweisungen auf den angegebenen Download-Seiten folgen.

## Projekt anlegen

Öffnen Sie R-Studio (Startmenu oder  Taskleiste  oder Kommandozeile  oder ... ). 


Erzeugen Sie ein neues Projekt innerhalb des Übungsordners (*statistik_vorlesung*):

File -> New Project...

Im sich öffnenden *New Project Wizard* wählen Sie: Existing Directory

Dann wählen Sie im nächsten Schritt den Ordner aus, den Sie oben angelegt haben (*statistik_vorlesung*).

Projekte dienen der Organisation von Dateien. Die Idee ist, dass alle Dateien die zur Übung/Vorlesung gehören hier abgelegt sind. Wenn Sie später ein anderes Projekt bearbeiten möchten, z.B. in Ihrer Bachelorarbeit, dann legen Sie ein neues Projekt an. Sie können dann einfach zwischen den Projekten wechseln.

Pfade beziehen sich immer auf die Projektdatei, d.h. wenn Sie z.B. Daten laden möchten, die sich innerhalb des *data* Unterordnern befinden, können Sie die Datei *meineDatei.csv* einfach mit *data/meineDatei.csv* ansprechen.

# Übung

Laden Sie das RMarkdown Dokument *u1.Rmd*, dass Sie aus Moodle heruntergeladen haben. Speichern Sie es unter einem sinnvollen Namen, z.B. u1.Rmd im Übungsordner(*statistik_vorlesung*) ab (File -> Save As...).

Tragen Sie in den YAML Header (der Teil ganz oben, der von drei aufeinanderfolgenden Minuszeichen Markiert ist) ihren Namen ein (innerhalb der doppelten Anführungszeichen).

Alles innerhalb der Codechunks enthält ausführbaren Code, der Rest ist Markdown Text, also Text mit Auszeichnungen wie Überschrift, Fett, Kursiv.

```{r}
# das ist ein Code Chunk
```



## Laden der Daten

Wir wollen die Datei *data/inkar_ue1.csv* laden. Bei Textdateien, die Tabelleninformationen enthalten, geschieht dies mit Hilfe der Funktion `read.table`. Wir müssen aber ggf. eine Reihe von Einstellungen vornehmen, da es viele Möglichkeiten gibt, solche Textdateien anzulegen.

Am besten schauen wir uns die Datei in einem Texteditor oder einfach in R-Studio an - **wichtig:** öffnen Sie die Datei **nicht** in Excel/Calc oder einem ähnlichen Spreadsheet Programm. D.h. verwenden Sie keinen Doppelklick um die Datei zu öffnen. Wenn Sie die Datei im Dateiverzeichnis (Explorer/Nautilus/Total Commander/...) rechts anklicken sollten Sie eine Option *Öffnen mit...* erhalten. Wählen Sie dann einen Texteditor (nicht Word), z.B. Notepad, Notepad++, GVim, kedit,... Oder Sie verwenden R-Studio im Files Pannel: links klicken und *View file* aus wählen (**nicht** *Import  Dataset*).

Nun sollten Sie in der Lage sein, die nachfolgenden Fragen zu beantworten:

  - enthält die erste Zeile die Spaltennamen? Falls ja, verwenden Sie den Parameter `header=TRUE` (Groß-/Kleinschreibung ist wichtig), ansonsten `header=FALSE`.
  - welches Trennzeichen wird verwendet um die einzelnen Spalten voneinander abzugrenzen? Wenn es sich um Whitespace (Leerzeichen und/oder Tabulatoren) handelt, müssen Sie nichts angeben, sonst müssen Sie dass Trennzeichen mittels `sep=""` angeben. Übliche Trennzeichen sind `sep=";"`, `sep=","`, `sep="/"`,...
  - wird der Punkt oder das Komma als Dezimaltrennzeichen verwendet? Suchen Sie nach Nummerischen Werte und schauen Sie, mit was Nachkommastellen beschrieben sind. Falls das Komma verwendet wird, kann es sein, dass die Zahlenwerte jeweils in Anführungszeichen gepackt sind um sie als String zu kennzeichen. Falls das Trennzeichen das Komma ist, müssen sie dies der Funktion mittels `dec=","` mitteilen. Falls der Punkt verwendet wird, müssen Sie nichts weiter machen.

Wir speichern den Rückgabewert der Funktion in einer Variable. Der Name ist relativ egal, solange i) Sie wissen, was gemeint ist, ii) der Name mit einem Buchstaben beginnt, und dann aus Buchstaben, Zahlen, Unterstrichen und Punkten besteht (Leerzeichen sind nicht erlaubt), iii) der Name nicht mit einem anderen Objekt, dass Sie behalten wollen oder einer R-Funktion übereinstimmt. Wir verwenden hier `dat` (nicht `data`, da es eine Funktion gleichen Namens gibt).

```{r}
# Sie müssen die entsprechenden Parameter noch setzen
dat <- read.table("data/inkar_ue1.csv",header = TRUE,sep = ";")
```


Nach dem Laden führen wir `summary` an dem Objekt aus, d.h. `summary(dat)`

```{r}
summary(dat)
```

Der Output von `summary` gibt uns bei numerischen Werten einen groben Überblick über die Verteilung der Daten (Größter Werte, Kleinster Wert, Mittelwert, Quantile) und würde uns auch anzeigen, falls für einzelne Felder Werte fehlen würden (NA).

Mit `head()`können wir uns die ersten 6 Zeilen eines data.frames anzeigen lassen.

```{r}
head(dat)
```
Für die Interpretation der Daten benötigen wir natürlich Meta-informationen (Einheiten,...). Es handelt sich um aktuelle Daten zur Raumstatistik in Deutschland auf Kreisebene. Für Details verweise ich auf https://www.inkar.de/documents/Uebersicht%20der%20Indikatoren.xlsx. Hier ein paar grobe Informationen:

  - Kennziffer - ID
  - Raumeinheit - der Name des Kreises
  - Aggregat - kreisfreie Stadt oder Landkreis
  - Medianeinkommen - Medianeinkommen der sozialversicherungspflichtig Vollzeitbeschäftigten in Euro
  - Ausländeranteil - Anteil der Ausländer an den Einwohnern in %
  - Stimmenanteile.Die.Linke , ... Anteil der Zweitstimmen der letzten Bundestagswahl, die auf die Partei entfallen sind
  
Wenn Sie wissen möchten, welche Spaltennamen es in einem data.frame gibt, können Sie `names(data.frame.name)`verwenden.

```{r}
names(dat)
```

  
## Plotten von Zusammenhängen

Es gibt in R mehrere Optionen, Daten zu plotten. Diese sind in Erweiterungspaketen enthalten. Solche sogenannte `packages` sind entweder bereits in der Installation von R enthalten, oder müssen nachinstalliert werden (z.B. im Pannel Packages -> Install). Um ein installiertes package verfügbar zu machen, muss man das package laden. Dies geschieht über `require(packagename)` oder `library(packagename)`. Wichtig ist es aufzupassen, was R für eine Rückmeldung gibt. 
`Warning: there is no package called ‘packagename’` deutet an, dass das package nicht installiert ist. Groß- und Kleinschreibung ist generell wichtig.

Hier laden wir `ggplot2` als eine moderne Option um Daten zu plotten. Das package sollte mit R installiert worden sein. Falls nicht, müssen Sie es nachinstallieren.

```{r}
require(ggplot2)
```

`ggplot2` folgt folgender Logik:

  - `ggplot()` spezifiziert über den Parameter `data = ` den data.frame (tabellarischen Datensatz), aus dem die zu plottenden Daten stammen. Mittel `mapping = aes()` werden die Felder des data.frames auf graphische Variablen gematcht.
  - dann werden mittels  (überladenem) `+` Operator weitere Manipulationen vorgenommen. 
  - relevant ist vor allem die Definition wie die Variablen dargestellt werden sollen. Für einen Scatterplot ist das `geom_point()`, Linien kann man über `geom_line()` darstellen, Histogramme über `geom_histogramm()` und vieles viels mehr.
  - dann können z.B. die Achsenbeschriftungen überarbeitet werden, ein Titel vergeben werden, die Skalierung der Achsen geändert werden oder Text in der Abbildung platziert werden.
  
Hier plotten wir das Medianeinkommen eines Kreises gegen den Zweitstimmenanteil der AfD bei der letzten Bundestagswahl. Als data.frame verwenden wir den Datensatz, den wir zuvor geladen haben (`dat`). Wir spezifizieren dann, welche der Felder auf die x und auf die y-Koordinaten gemappt werden sollen, indem wir `x` und `y` den Namen (ohne Anführungszeichen) des Feldes zuweisen. Mittels `geom_point()` sagen wir nun, dass wir einen Scatterplot erzeugen wollen.

```{r}
ggplot(data = dat, mapping = aes(x= Stimmenanteile.AfD, y=Medianeinkommen)) +
  geom_point()
```

**Moodle-Aufgabe:** Wie ist der Zusammenhang zwischen dem Zweitstimmenanteil der AfD und dem Medianeinkommen? Wählen eher ärmere oder eher reichere Kreise stärker die AfD?

Finetuning: Wir können den Plot noch weiter aufhübschen, z.B.:

  - mit `xlab("achsenbeschriftung")`und `ylab("achsenbeschriftung")` die Achsenbeschriftung modifzieren
  - mit `labs(title = "Titel", subtitle = "Uhntertitel")` den Plot beschriften
  - genauer spezifieren, welches Punktsymbol verwendet werden soll, z.B. mittel `color` und `alpha` (Transparenz, um Überlagerungen erkennen zu können)

```{r}
ggplot(data = dat, aes(x= Stimmenanteile.AfD, y=Medianeinkommen)) +
  geom_point(color = "blue", alpha = .5) +
  xlab("Simmenanteile AfD") +
  labs(title = "Daten zur Raumstatistik", subtitle = "Dtld., Kreisebene")
```

Wir können dasselbe natürlich auch für andere Variablen machen, z.B. den Stimmenanteil der AfD gegen den Ausländeranteil.

```{r}
ggplot(data = dat, aes(x= Stimmenanteile.AfD, y=Ausländeranteil)) +
  geom_point() +
  #xlab("Simmenanteile AfD") +
  labs(title = "Daten zur Raumstatistik", subtitle = "Dtld., Kreisebene")
```

Nun sollen Sie den Plot modifizieren. Plotten sie das Medianeinkommen (x-Achse) gegen den Ausländeranteil. Kopieren Sie hierfür am einfachsten den Inhalt des obigen Code-Chunks und modifizieren Sie die `mapping = aes()` Definition. Die genauen Feldnamen finden Sie oben (z.B. `names(dat)`).


```{r}
ggplot(data = dat, mapping = aes(x=Medianeinkommen, y=Ausländeranteil)) +
  geom_point(color = "blue", alpha = .5) +
  #xlab("Medianeinkommen") +
  labs(title = "Daten zur Raumstatistik", subtitle = "Dtld., Kreisebene")
```


Plotten Sie nun das Medianeinkommen gegen die Stimmenanteile der Linken

```{r}
ggplot(data = dat, mapping = aes(x=Medianeinkommen, y=Stimmenanteile.Die.Linke)) +
  geom_point(color = "blue", alpha = .5) +
  #xlab("Medianeinkommen") +
  labs(title = "Daten zur Raumstatistik", subtitle = "Dtld., Kreisebene")
```

und nun das Medianeinkommen gegen die Stimmenanteile der Grünen

```{r}
ggplot(data = dat, mapping = aes(x=Medianeinkommen, y=Stimmenanteile.Grüne)) +
  geom_point(color = "blue", alpha = .5) +
  #xlab("Medianeinkommen") +
  labs(title = "Daten zur Raumstatistik", subtitle = "Dtld., Kreisebene")
```

und nun das Medianeinkommen gegen die Stimmenanteile der FDP.

```{r}
ggplot(data = dat, mapping = aes(x=Medianeinkommen, y=Stimmenanteile.FDP)) +
  geom_point(color = "blue", alpha = .5) +
  #xlab("Medianeinkommen") +
  labs(title = "Daten zur Raumstatistik", subtitle = "Dtld., Kreisebene")
```

Speichern Sie die RMarkdown Datei. Erzeugen Sie anschließend das zugehörige HTML Dokument (z.B: Strg + Shift + k oder Sie verwenden die Schaltfläche *Knit*) und laden Sie es zusammen mit der Rmd Datei auf Moodle hoch

**Beantworten Sie nun die Fragen in Moodle.**
